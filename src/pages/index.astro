---
import { getCollection } from "astro:content";
import { Picture } from "astro:assets";
import BaseLayout from "../layouts/BaseLayout.astro";

const pageTitle = "Selected Work";
const metaTitle = "Matthew Oyan - Multimedia Artist Portfolio";
const pageDescription =
  "Selected work and projects by Matthew Oyan, a multimedia artist working in various digital media and live events, based in the Philippines.";

// Fetch all portfolio entries
const portfolioEntries = await getCollection("portfolio", ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

// Sort entries by date in descending order (most recent first)
portfolioEntries.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<BaseLayout
  pageTitle={pageTitle}
  metaTitle={metaTitle}
  pageDescription={pageDescription}
>
  <div class="portfolio-grid">
    {
      portfolioEntries.map((entry) => (
        <a href={`/portfolio/${entry.slug}`} class="portfolio-item">
          <div class="portfolio-thumbnail-container">
            {entry.data.image && (
              <Picture
                src={entry.data.image}
                formats={["avif", "webp"]}
                widths={[300, 400, 600, 800]}
                sizes="(max-width: 768px) 300px, (max-width: 1200px) 400px, 600px"
                alt={entry.data.imageAlt || entry.data.title}
                class="portfolio-thumbnail"
              />
            )}
            <div class="portfolio-title-overlay">
              <h3>{entry.data.title}</h3>
            </div>
          </div>
        </a>
      ))
    }
  </div>
</BaseLayout>

<script
  type="application/ld+json"
  set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    name: metaTitle,
    description: pageDescription,
    url: Astro.url.href,
    image: "/images/MatthewOyan_2025_headshot_optimized_65.webp",
    publisher: {
      "@type": "Organization",
      name: "Matthew Oyan",
      logo: {
        "@type": "ImageObject",
        url: "/favicon.svg",
      },
    },
  })}
/>
